<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Flashpoint Risk Index Lookup</title>
    <style>
      :root {
        color-scheme: light dark;
        --radius-lg: 24px;
        --card-glass: rgba(255, 255, 255, 0.12);
        --card-border: rgba(255, 255, 255, 0.35);
        --shadow-strong: 0 30px 60px rgba(15, 23, 42, 0.35);
        --text-primary: rgba(255, 255, 255, 0.95);
        --text-secondary: rgba(255, 255, 255, 0.78);
        --text-muted: rgba(255, 255, 255, 0.62);
        --alert-bg: rgba(255, 255, 255, 0.12);
        --alert-border: rgba(255, 255, 255, 0.35);
        --accent: #38bdf8;
        --focus-ring: rgba(56, 189, 248, 0.45);
        --nav-bg: rgba(15, 23, 42, 0.35);
        --nav-border: rgba(255, 255, 255, 0.12);
        --help-bg: rgba(255, 255, 255, 0.08);
        --help-border: rgba(255, 255, 255, 0.35);
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
        margin: 0;
        font-family: "Inter", "Segoe UI", "Helvetica Neue", Arial, sans-serif;
        color: var(--text-primary);
        background: radial-gradient(circle at top left, #1f2937, #0f172a 60%, #020617);
      }

      body {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 24px;
        transition: background 0.6s ease;
      }

      body.low {
        --accent: #38bdf8;
        --focus-ring: rgba(56, 189, 248, 0.45);
        --card-glass: rgba(14, 165, 233, 0.18);
        --card-border: rgba(125, 211, 252, 0.45);
        --nav-bg: rgba(14, 165, 233, 0.16);
        --nav-border: rgba(125, 211, 252, 0.35);
        --help-bg: rgba(14, 165, 233, 0.18);
        --help-border: rgba(125, 211, 252, 0.45);
        --alert-bg: rgba(56, 189, 248, 0.12);
        --alert-border: rgba(56, 189, 248, 0.35);
        background: radial-gradient(circle at top left, #0ea5e9, #0f172a 70%, #020617);
      }

      body.elevated {
        --accent: #f59e0b;
        --focus-ring: rgba(245, 158, 11, 0.45);
        --card-glass: rgba(245, 158, 11, 0.18);
        --card-border: rgba(251, 191, 36, 0.45);
        --nav-bg: rgba(180, 83, 9, 0.22);
        --nav-border: rgba(251, 191, 36, 0.45);
        --help-bg: rgba(245, 158, 11, 0.22);
        --help-border: rgba(251, 191, 36, 0.45);
        --alert-bg: rgba(245, 158, 11, 0.18);
        --alert-border: rgba(251, 191, 36, 0.5);
        background: radial-gradient(circle at top left, #f59e0b, #7c2d12 60%, #1f2937);
      }

      body.high {
        --accent: #f97316;
        --focus-ring: rgba(249, 115, 22, 0.45);
        --card-glass: rgba(249, 115, 22, 0.18);
        --card-border: rgba(251, 146, 60, 0.45);
        --nav-bg: rgba(234, 88, 12, 0.22);
        --nav-border: rgba(251, 146, 60, 0.45);
        --help-bg: rgba(249, 115, 22, 0.22);
        --help-border: rgba(251, 146, 60, 0.45);
        --alert-bg: rgba(249, 115, 22, 0.18);
        --alert-border: rgba(251, 146, 60, 0.5);
        background: radial-gradient(circle at top left, #fb923c, #7c2d12 60%, #111827);
      }

      body.critical {
        --accent: #f43f5e;
        --focus-ring: rgba(244, 63, 94, 0.45);
        --card-glass: rgba(244, 63, 94, 0.18);
        --card-border: rgba(248, 113, 113, 0.45);
        --nav-bg: rgba(244, 63, 94, 0.2);
        --nav-border: rgba(252, 165, 165, 0.5);
        --help-bg: rgba(244, 63, 94, 0.24);
        --help-border: rgba(252, 165, 165, 0.55);
        --alert-bg: rgba(244, 63, 94, 0.22);
        --alert-border: rgba(248, 113, 113, 0.55);
        background: radial-gradient(circle at top left, #f43f5e, #7f1d1d 60%, #111827);
      }

      .page-wrapper {
        width: min(960px, 100%);
        display: flex;
        flex-direction: column;
        gap: 24px;
      }

      .top-nav {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 20px;
        background: var(--nav-bg);
        border-radius: 18px;
        backdrop-filter: blur(12px);
        border: 1px solid var(--nav-border);
        box-shadow: 0 18px 30px rgba(2, 6, 23, 0.35);
      }

      .top-nav h1 {
        margin: 0;
        font-size: clamp(1.25rem, 2.4vw, 1.65rem);
        letter-spacing: 0.02em;
        font-weight: 600;
      }

      .help-button {
        border: 1px solid var(--help-border);
        border-radius: 999px;
        padding: 8px 14px;
        background: var(--help-bg);
        color: var(--text-primary);
        font-size: 0.9rem;
        display: inline-flex;
        gap: 8px;
        align-items: center;
        cursor: pointer;
        transition: background 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
      }

      .help-button:hover,
      .help-button:focus-visible {
        background: rgba(255, 255, 255, 0.22);
        transform: translateY(-1px);
        box-shadow: 0 10px 20px rgba(15, 23, 42, 0.35);
        outline: 2px solid var(--accent);
        outline-offset: 3px;
      }

      .app-card {
        position: relative;
        background: var(--card-glass);
        border: 1px solid var(--card-border);
        border-radius: var(--radius-lg);
        padding: clamp(24px, 5vw, 40px);
        backdrop-filter: blur(24px);
        box-shadow: var(--shadow-strong);
        overflow: hidden;
      }

      body.critical .app-card {
        border-top: 3px solid rgba(244, 63, 94, 0.8);
        animation: pulseGlow 3.5s ease-in-out infinite;
      }

      @keyframes pulseGlow {
        0% {
          box-shadow: var(--shadow-strong);
        }
        50% {
          box-shadow: 0 40px 90px rgba(244, 63, 94, 0.55);
        }
        100% {
          box-shadow: var(--shadow-strong);
        }
      }

      @media (prefers-reduced-motion: reduce) {
        .help-button,
        button#check,
        .segment,
        .segment::after,
        body.critical .app-card {
          transition: none !important;
          animation: none !important;
        }
      }

      form {
        display: grid;
        gap: 18px;
      }

      .field-group {
        display: grid;
        gap: 6px;
      }

      label {
        font-size: 0.9rem;
        font-weight: 600;
        letter-spacing: 0.02em;
        color: var(--text-secondary);
      }

      input,
      select {
        width: 100%;
        padding: 12px 14px;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.25);
        background: rgba(15, 23, 42, 0.45);
        color: var(--text-primary);
        font-size: 1rem;
        transition: border 0.3s ease, box-shadow 0.3s ease;
      }

      input:focus-visible,
      select:focus-visible,
      button:focus-visible {
        outline: 2px solid var(--accent);
        outline-offset: 3px;
        box-shadow: 0 0 0 4px var(--focus-ring);
      }

      button#check {
        margin-top: 4px;
        padding: 14px 18px;
        border-radius: 14px;
        border: none;
        background: linear-gradient(135deg, var(--accent), rgba(255, 255, 255, 0.25));
        color: #0f172a;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.25s ease, box-shadow 0.25s ease;
      }

      button#check:hover,
      button#check:active {
        transform: translateY(-2px);
        box-shadow: 0 18px 30px rgba(15, 23, 42, 0.4);
      }

      button#check:disabled {
        cursor: progress;
        opacity: 0.7;
        transform: none;
        box-shadow: none;
      }

      .result-header {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-top: 12px;
      }

      .score-display {
        display: flex;
        align-items: baseline;
        gap: 16px;
      }

      #bigscore {
        font-size: clamp(3.25rem, 7vw, 4.5rem);
        font-weight: 700;
        line-height: 1;
      }

      #band {
        font-size: clamp(1.1rem, 2.6vw, 1.5rem);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.12em;
      }

      #barfill {
        margin-top: 18px;
        display: grid;
        grid-template-columns: repeat(10, minmax(0, 1fr));
        gap: 6px;
      }

      .segment {
        position: relative;
        height: 16px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.16);
        overflow: hidden;
        transform: scaleX(0.9);
        transform-origin: center;
        opacity: 0.35;
      }

      .segment::after {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: inherit;
        background: var(--accent);
        transform: scaleX(0);
        transform-origin: left;
        transition: transform 0.4s ease;
      }

      .segment.filled {
        opacity: 1;
        transform: scaleX(1);
      }

      .segment.filled::after {
        transform: scaleX(1);
      }

      .legend {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 18px;
      }

      .legend-badge {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 14px;
        border-radius: 999px;
        font-size: 0.85rem;
        font-weight: 600;
        letter-spacing: 0.04em;
        color: #0f172a;
      }

      .legend-badge::before {
        content: "";
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: currentColor;
      }

      .badge-low {
        color: #0f172a;
        background: rgba(56, 189, 248, 0.85);
      }

      .badge-elevated {
        color: #0f172a;
        background: rgba(245, 158, 11, 0.85);
      }

      .badge-high {
        color: #0f172a;
        background: rgba(249, 115, 22, 0.85);
      }

      .badge-critical {
        color: #0f172a;
        background: rgba(244, 63, 94, 0.88);
      }

      #advisory {
        margin-top: 22px;
        font-size: 1rem;
        line-height: 1.6;
        color: var(--text-secondary);
        background: rgba(15, 23, 42, 0.35);
        border-radius: 16px;
        padding: 18px;
        border: 1px solid rgba(255, 255, 255, 0.12);
      }

      #alert {
        margin-top: 16px;
        border-radius: 14px;
        padding: 12px 16px;
        background: var(--alert-bg);
        border: 1px solid var(--alert-border);
        color: var(--text-primary);
        display: flex;
        align-items: flex-start;
        gap: 12px;
      }

      #alert[hidden] {
        display: none !important;
      }

      .alert-dismiss {
        background: none;
        border: none;
        color: var(--text-secondary);
        cursor: pointer;
        font-size: 1rem;
        padding: 4px;
      }

      .alert-dismiss:hover,
      .alert-dismiss:focus-visible {
        color: var(--text-primary);
        outline: 2px solid var(--accent);
        border-radius: 50%;
      }

      .meta {
        margin-top: 12px;
        font-size: 0.85rem;
        color: var(--text-muted);
      }

      .diagnostics {
        margin-top: 24px;
        padding: 18px;
        border-radius: 16px;
        background: rgba(15, 23, 42, 0.35);
        border: 1px solid rgba(255, 255, 255, 0.12);
        font-family: "JetBrains Mono", "Fira Code", monospace;
        display: none;
      }

      .diagnostics pre {
        white-space: pre-wrap;
        margin: 0;
      }

      .diagnostics button {
        margin-top: 12px;
        align-self: flex-start;
        background: rgba(255, 255, 255, 0.12);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 10px;
        padding: 8px 12px;
        color: var(--text-primary);
        cursor: pointer;
      }

      .diagnostics button:hover,
      .diagnostics button:focus-visible {
        background: rgba(255, 255, 255, 0.22);
        outline: 2px solid var(--accent);
        outline-offset: 3px;
      }

      .help-modal {
        position: fixed;
        inset: 0;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 24px;
        background: rgba(2, 6, 23, 0.65);
        backdrop-filter: blur(18px);
        z-index: 1000;
      }

      .help-modal[aria-hidden="false"] {
        display: flex;
      }

      .help-modal-content {
        background: rgba(15, 23, 42, 0.92);
        border-radius: 20px;
        border: 1px solid rgba(255, 255, 255, 0.18);
        padding: 28px;
        width: min(480px, 100%);
        color: var(--text-secondary);
        position: relative;
        box-shadow: 0 30px 60px rgba(15, 23, 42, 0.55);
      }

      .modal-close {
        position: absolute;
        top: 14px;
        right: 14px;
        background: none;
        border: none;
        color: var(--text-muted);
        font-size: 1.25rem;
        cursor: pointer;
      }

      .modal-close:hover,
      .modal-close:focus-visible {
        color: var(--text-primary);
        outline: 2px solid var(--accent);
        border-radius: 50%;
      }

      @media (min-width: 720px) {
        form {
          grid-template-columns: repeat(2, minmax(0, 1fr));
          gap: 20px 24px;
        }

        .field-group.full {
          grid-column: 1 / -1;
        }

        .result-header {
          flex-direction: row;
          align-items: flex-end;
          justify-content: space-between;
        }
      }
    </style>
  </head>
  <body class="low">
    <div class="page-wrapper">
      <header class="top-nav">
        <h1>Flashpoint Risk Index (FRI)</h1>
        <button
          type="button"
          id="helpButton"
          class="help-button"
          aria-haspopup="dialog"
          aria-controls="helpModal"
          aria-expanded="false"
        >
          <span aria-hidden="true">❓</span>
          <span>Help</span>
        </button>
      </header>

      <main class="app-card" aria-live="polite">
        <form id="lookupForm" novalidate>
          <div class="field-group">
            <label for="date">Date</label>
            <input id="date" name="date" type="date" required />
          </div>
          <div class="field-group">
            <label for="state">State</label>
            <select id="state" name="state" required></select>
          </div>
          <div class="field-group full">
            <label for="city">City or County (optional)</label>
            <input id="city" name="city" type="text" placeholder="e.g., Webster" />
          </div>
          <div class="field-group full">
            <button id="check" type="submit">Check Risk</button>
          </div>
        </form>

        <div id="alert" role="alert" hidden>
          <div>
            <strong>No data published for that place/date.</strong>
            <div class="meta">Try a nearby city or remove the city filter to check statewide data.</div>
          </div>
          <button type="button" class="alert-dismiss" aria-label="Dismiss alert">✕</button>
        </div>

        <div class="result-header">
          <div class="score-display">
            <div id="bigscore" aria-live="polite">0</div>
            <div id="band">Low</div>
          </div>
        </div>

        <div id="barfill" aria-hidden="true"></div>

        <div class="legend" aria-hidden="true">
          <span class="legend-badge badge-low">Low</span>
          <span class="legend-badge badge-elevated">Elevated</span>
          <span class="legend-badge badge-high">High</span>
          <span class="legend-badge badge-critical">Critical</span>
        </div>

        <section id="advisory" aria-live="polite">Normal conditions. Know your route; buddy up.</section>

        <section class="diagnostics" id="diagnostics" aria-live="polite">
          <h2 style="margin-top: 0; font-size: 1.1rem; font-weight: 600; color: var(--text-secondary)">
            Diagnostics
          </h2>
          <pre id="diagnosticsContent"></pre>
          <button type="button" id="copyDebug">Copy Debug Snapshot</button>
        </section>
      </main>
    </div>

    <div class="help-modal" id="helpModal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="helpTitle">
      <div class="help-modal-content" tabindex="-1">
        <button type="button" class="modal-close" id="helpClose" aria-label="Close help">✕</button>
        <h2 id="helpTitle" style="margin-top: 0; color: var(--text-primary); font-size: 1.4rem;">How the lookup works</h2>
        <p>
          Enter a date, choose a state, and optionally add a city or county. The lookup fetches the matching
          Flashpoint Risk Index record from the <strong>public, read-only Firestore JSON snapshot</strong> you host at
          <code>/risk/</code>.
        </p>
        <p>
          Scores map to bands as follows: 0–2 Low, 3–5 Elevated, 6–8 High, 9–10 Critical. Each band loads a ready-made
          safety checklist unless the record includes a specific advisory message.
        </p>
        <p>
          To troubleshoot, append <code>?debug=1</code> to the page URL to show diagnostics with the last fetch details.
        </p>
      </div>
    </div>

    <script src="app.js" defer></script>
  </body>
</html>
